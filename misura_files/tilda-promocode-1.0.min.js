function t_input_promocode_init(recId,lid){var rec=document.querySelector("#rec"+recId);if(rec){var wrapper=rec.querySelector('[data-input-lid="'+lid+'"]');if(wrapper){var inputPromocode=wrapper.querySelector(".t-inputpromocode");if(inputPromocode){var btnPromocode=wrapper.querySelector(".t-inputpromocode__btn");inputPromocode.setAttribute("autocomplete",navigator.userAgent.search(/Chrome/)>0?"no":"off"),inputPromocode.addEventListener("focus",(function(){btnPromocode.style.display="table-cell"})),btnPromocode.addEventListener("click",(function(){t_input_promocode__applyPromoCode(wrapper,inputPromocode,btnPromocode)}))}}}}function t_input_promocode__applyPromoCode(wrapper,input,btn){var val=input.value;if(val){var allRecords=document.querySelector("#allrecords"),dataPromocode=new FormData;if(dataPromocode.append("promocode",val),dataPromocode.append("projectid",allRecords.getAttribute("data-tilda-project-id")),dataPromocode.has("projectid")){var currentMode=allRecords.getAttribute("data-tilda-mode"),isPublishedPage;if("edit"!==currentMode&&"preview"!==currentMode){if(window.t_promocode_load&&"y"===window.t_promocode_load)return;window.t_promocode_load="y",btn.classList.add("t-btn_sending");var xhr=new XMLHttpRequest;xhr.open("POST","https://"+window.tildaForm.endpoint+"/payment/promocode/",!0),xhr.onload=function(){if(xhr.status>=200&&xhr.status<400){delete window.t_promocode_load,btn.classList.remove("t-btn_sending");var data=xhr.responseText;if(data){var objData=JSON.parse(data);if("object"==typeof objData)if(objData.message&&"OK"===objData.message){var str="";if(str+='<div style="font-weight:600;" class="t-text">'+t_input_promocode__getLangText("promocode")+" ",str+=objData.promocode,str+=" "+t_input_promocode__getLangText("activated")+".<br>"+t_input_promocode__getLangText("discount")+": ",objData.discountsum&&objData.discountsum>0)if("object"==typeof window.tcart)try{"function"==typeof tcart__showPrice&&(str+=tcart__showPrice(objData.discountsum))}catch(e){}else str+=objData.discountsum;objData.discountpercent&&objData.discountpercent>0&&(str+=parseFloat(objData.discountpercent)+"%"),str+="</div>",wrapper.querySelector(".t-inputpromocode__wrapper").innerHTML=str,wrapper.querySelector(".t-input-error").innerHTML="",t_input_promocode__addPromocode(objData);try{var form=wrapper.closest(".t-form");window.tildaForm.hideErrors(form),window.tildaForm.showErrors(form,window.tildaForm.validate(form))}catch(error){console.error("Error boxes cannot be cleared")}}else objData.error&&objData.error?alert(objData.error):alert("Promo code activation some error.");else alert("Promo code activation error. Bad answer from server")}else alert("Promo code activation error. Empty answer from server")}else delete window.t_promocode_load,btn.classList.remove("t-btn_sending"),alert("Request status error "+xhr.status)},xhr.onerror=function(){delete window.t_promocode_load,btn.classList.remove("t-btn_sending"),alert("Request timeout error (activate promo code)")},xhr.send(dataPromocode)}else alert(t_input_promocode__getLangText("publish"))}else alert(t_input_promocode__getLangText("badprojectid"))}else console.log("Promo code is empty")}function t_input_promocode__addPromocode(promocodeObject){"object"!=typeof window.tcart.promocode?("object"==typeof promocodeObject&&void 0!==promocodeObject.promocode&&""!=promocodeObject.promocode&&(promocodeObject.discountsum>0||promocodeObject.discountpercent>0)&&(window.tcart.promocode=promocodeObject),window.tcart_newDeliveryActive&&window.tcart.amount&&window.tcart.total&&tcart__rerenderDeliveryServices(),tcart__updateTotalProductsinCartObj(),tcart__reDrawTotal()):console.error("Error. Promocode already activated before")}function t_input_promocode__getLangText(msg){var dict=[];dict.publish={EN:"Please, publish the page, to test promo code activation functionality",RU:"Пожалуйста, опубликуйте страницу, чтобы проверить функциональность активации промокода",FR:"S'il vous plaît, publier la page, pour tester la fonctionnalité d'activation promo de code",DE:"Bitte veröffentlichen Sie die Seite, um Testgutscheincode Aktivierung Funktionalität",ES:"Por favor, publicar la página, a la funcionalidad de activación código promocional prueba",PT:"Por favor, publicar a página, a funcionalidade de ativação código de teste promo",UK:"Будь ласка, опублікуйте сторінку, щоб перевірити функціональність активації промокоду",JA:"、テスト用プロモーションコードのアクティベーション機能に、ページを公開してください。",ZH:"请发布页面，测试促销代码激活功能",PL:"Opublikuj stronę, aby przetestować funkcjonalność aktywacji kodu promocyjnego",KK:"Промокодты іске қосу функциясын тексеру үшін бетті жариялаңыз",IT:"Si prega, pubblicare la pagina, alla funzionalità il codice di attivazione di prova promozionale`",LV:"Lūdzu, publicējiet lapu, lai testa promo kodu aktivizācijas funkcionalitāti"},dict.badprojectid={EN:"Promo code activation error. Bad projectid",RU:"Ошибка активации промокода. Некорректный projectid",FR:"Promo Erreur d'activation de code. Bad projectId",DE:"Promo Code Aktivierungsfehler. Bad projectid",ES:"Error de activación de código promocional. Mala projectId",PT:"Promo erro de ativação código. Bad projectId",UK:"Помилка активації промокоду. Поганий projectid",JA:"プロモーションコードのアクティブ化エラー。悪い projectid",ZH:"促销代码激活错误。坏专案编号",PL:"Błąd aktywacji kodu promocyjnego. Bad projectid",KK:"Промокодты белсендіру қатесі. Нашар projectid",IT:"Errore di attivazione codice promozionale. Bad projectid",LV:"Promo kods aktivizācijas kļūda. Bad projectid"},dict.promocode={EN:"Promo code",RU:"Промокод",FR:"Code promo",DE:"Gutscheincode",ES:"Código promocional",PT:"Código promocional",UK:"Промокод",JA:"プロモーションコード",ZH:"促销代码",PL:"Kod rabatowy",KK:"Промокод",IT:"Codice promozionale",LV:"Promo kods"},dict.activated={EN:"has been activated",RU:"активирован",FR:"a été activé",DE:"wurde aktiviert",ES:"Ha sido activado",PT:"Foi ativado",UK:"активований",JA:"活性化されています",ZH:"已被激活",PL:"został aktywowany",KK:"болды белсендірілді",IT:"è stato attivato",LV:"ir aktivizēta"},dict.notused={EN:"not applied",RU:"не применена",FR:"non appliqué",DE:"nicht angewandt",ES:"no aplicado",PT:"não aplicado",UK:"не застосована",JA:"適用外",ZH:"未应用",PL:"nie zastosowana",KK:"қолданылмайды",IT:"non applicato",LV:"nav piemērots"},dict.used={EN:"applied",RU:"применена",FR:"appliquée",DE:"angewendet",ES:"aplicado",PT:"aplicado",UK:"застосована",JA:"適用済み",ZH:"已应用",PL:"zastosowana",KK:"қолданылады",IT:"applicato",LV:"piemērots"},dict.promocodediscount={EN:"Promo code discount",RU:"Скидка по промокоду",FR:"Remise liée à un code promotionnel",DE:"Promo-Code-Rabatt",ES:"Descuento por código promocional",PT:"Desconto por código promocional",UK:"Знижка за промокодом",JA:"プロモコード割引",ZH:"促销代码折扣",PL:"Kod promocyjny zniżki",KK:"Промо-код бойынша жеңілдік",IT:"Codice promozionale sconto",LV:"Promo kods atlaide"},dict.specialdiscount={EN:"Special discount",RU:"Специальная скидка",FR:"Remise spéciale",DE:"Sonderrabatt",ES:"Descuento especial",PT:"Desconto especial",UK:"Спеціальна знижка",JA:"特別割引",ZH:"特别折扣",PL:"Specjalna zniżka",KK:"Арнайы жеңілдік",IT:"Sconto speciale",LV:"Īpaša atlaide"},dict.discount={EN:"Your discount",RU:"Ваша скидка",FR:"votre remise",DE:"Ihr Rabatt",ES:"su descuento",PT:"seu desconto",UK:"Ваша знижка",JA:"あなたの割引",ZH:"您的折扣",PL:"Twój rabat",KK:"Сіздің жеңілдік",IT:"Lo sconto",LV:"Jūsu atlaide"},dict.ownerrestriction={EN:"The store owner banned the summation of discounts",RU:"Владелец магазина запретил суммирование скидок",FR:"Le propriétaire du magasin a interdit la somme des remises",DE:"Der Ladenbesitzer verbot die Aufsummierung von Rabatten",ES:"El dueño de la tienda prohibió la suma de descuentos",PT:"O proprietário da loja proibiu a soma dos descontos",UK:"Власник магазину заборонив підсумовувати знижки",JA:"店主が値引きの集計を禁止した件",ZH:"店主禁止打折的总和",PL:"Właściciel sklepu zakazał sumowania rabatów",KK:"Дүкен иесі жеңілдіктерді жинақтауға тыйым салды",IT:"Il proprietario del negozio ha vietato la sommatoria degli sconti",LV:"Veikala īpašnieks aizliedza atlaižu summēšanu"};var lang=(window.navigator.userLanguage||window.navigator.language).toUpperCase().slice(0,2),allrecords=document.getElementById("allrecords");if(allrecords){var projectLang=allrecords.getAttribute("data-tilda-project-lang");projectLang&&(lang=projectLang)}return dict[msg]?dict[msg][lang]?dict[msg][lang]:dict[msg].EN:"Text not found #"+msg}